import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.datasets import load_iris
import io

st.title("Simple Data Analysis App")

@st.cache_data
def load_data():
    iris = load_iris()
    df = pd.DataFrame(data=iris.data, columns=iris.feature_names)
    df['target'] = iris.target_names[iris.target]
    return df

df = load_data()

st.header("Dataset Preview")
st.write("Iris dataset loaded using scikit-learn")
st.dataframe(df.head())

st.header("Scatter Plot")
feature_x = st.selectbox("Select feature for X-axis", df.columns[:-1])
feature_y = st.selectbox("Select feature for Y-axis", df.columns[:-1])

fig, ax = plt.subplots()
sns.scatterplot(data=df, x=feature_x, y=feature_y, hue='target', palette='viridis', ax=ax)
st.pyplot(fig)

st.header("Correlation Heatmap")
numeric_df = df.select_dtypes(include=[np.number])
corr = numeric_df.corr()

fig, ax = plt.subplots()
sns.heatmap(corr, annot=True, cmap='coolwarm', ax=ax)
st.pyplot(fig)

st.header("Download Dataset")
buffer = io.StringIO()
df.to_csv(buffer, index=False)
csv_data = buffer.getvalue().encode('utf-8')
st.download_button(
    label="Download Iris Dataset as CSV",
    data=csv_data,
    file_name="iris_dataset.csv",
    mime="text/csv"
)